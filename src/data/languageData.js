const CONTROL_KEYWORDS = new Set([
  'if',
  'elseif',
  'else',
  'endif',
  'while',
  'done',
  'break',
  'subroutine',
  'endsubroutine',
  'gosub',
  'returnsub',
  'end'
]);

const CONTROL_KEYWORD_DOCS = {
  if: 'Starts a conditional block. Format: `if value1 condition value2`.',
  elseif: 'Conditional branch evaluated when previous `if`/`elseif` conditions are false.',
  else: 'Fallback branch when `if` and all `elseif` conditions are false.',
  endif: 'Closes an `if` block.',
  while: 'Starts a conditional loop block.',
  done: 'Closes a `while` loop block.',
  break: 'Exits the current `while` loop.',
  subroutine: 'Starts a named subroutine block.',
  endsubroutine: 'Closes a `subroutine` block.',
  gosub: 'Calls a named subroutine.',
  returnsub: 'Returns early from the current subroutine.',
  end: 'Ends script processing.'
};

const COMMANDS = new Set([
  'echo',
  'seti',
  'sets',
  'exit',
  'hex',
  'decimal',
  'printbuffer',
  'stringtobuffer',
  'clearbuffer',
  'buffersize',
  'writebuffer',
  'readbuffer',
  'direction',
  'scsi6cmd',
  'scsi10cmd',
  'scsi12cmd',
  'printsensebuffer',
  'setreadpio',
  'setwritepio',
  'setreaddma',
  'setwritedma',
  'ata28cmd',
  'ata48cmd',
  'writelog',
  'setbuffer',
  'endbuffer',
  'scratchpadsize',
  'writescratchpad',
  'readscratchpad',
  'copyscratchpadtobuffer',
  'copybuffertoscratchpad',
  'printscratchpad',
  'setscratchpad',
  'endscratchpad',
  'stringtoscratchpad',
  'clearscratchpad',
  'variablecheck',
  'getfilesize',
  'deletefile',
  'callcommand',
  'userinput',
  'wordflipbuffer',
  'wordflipscratchpad',
  'getstatus',
  'softreset',
  'usleep',
  'softtimeout',
  'resettimeout',
  'busytimeout',
  'generaltimeout',
  'gettime',
  'reopendisk',
  'include',
  'loadscript',
  'previousscript',
  'upline'
]);

const INCLUDE_COMMANDS = new Set(['include', 'loadscript']);

const BUILTIN_VARIABLE_DOCS = {
  error_level: 'Some commands return command-specific data in this variable.',
  io_sense_key: 'Sense key (part of the key code qualifier). Passthrough only.',
  io_asc: 'Additional sense code (part of the key code qualifier). Passthrough only.',
  io_ascq: 'Additional sense code qualifier (part of the key code qualifier). Passthrough only.',
  io_status: 'SCSI status byte as defined by the SCSI standard. Passthrough only.',
  io_masked_status: 'SCSI generic masked status. Passthrough only.',
  io_msg_status: 'SCSI generic message status. Passthrough only.',
  io_sb_len_wr: 'Number of bytes in the sense buffer. Passthrough only.',
  io_host_status: 'SCSI generic host status. Passthrough only.',
  io_driver_status: 'SCSI generic driver status. Passthrough only.',
  io_resid: 'SCSI generic residual count. Passthrough only.',
  io_duration: 'Number of milliseconds the SCSI command took to complete. Passthrough only.',
  io_info: 'SCSI generic info field. Passthrough only.',
  ata_return_error: 'ATA error register data.',
  ata_return_count: 'ATA count register data.',
  ata_return_lba: 'ATA LBA register data combined into one value.',
  ata_return_device: 'ATA device register data.',
  ata_return_status: 'ATA status register data.',
  time: 'Value returned from the gettime command.',
  date: 'Value returned from the gettime command.',
  data_transferred: 'Returns number of bytes transferred (indication only, not a guarantee).',
  bus_master_status: 'Bus master status (direct mode DMA commands only).',
  direct_mode: 'Returns 1 if using direct mode, 0 if using passthrough mode.',
  ahci_mode: 'Returns 1 if using AHCI, 0 if using passthrough mode.'
};

const BUILTIN_FUNCTION_DOCS = {
  echo: 'Prints text/variables to screen.',
  seti: 'Sets an integer variable; supports simple arithmetic and buffer extraction.',
  sets: 'Sets a string variable; can also copy bytes from buffer to string.',
  exit: 'Terminates the script with an exit code.',
  hex: 'Switches default numeric processing to hex.',
  decimal: 'Switches default numeric processing back to decimal.',
  printbuffer: 'Prints buffer contents for a given offset/size.',
  stringtobuffer: 'Copies a string variable into buffer bytes.',
  clearbuffer: 'Clears the buffer contents.',
  buffersize: 'Sets the buffer size.',
  writebuffer: 'Writes buffer contents to a file.',
  readbuffer: 'Reads file contents into buffer.',
  direction: 'Sets data direction (from, to, tofrom, none) for command execution.',
  scsi6cmd: 'Executes a raw 6-byte SCSI command.',
  scsi10cmd: 'Executes a raw 10-byte SCSI command.',
  scsi12cmd: 'Executes a raw 12-byte SCSI command.',
  printsensebuffer: 'Prints the returned SCSI sense buffer.',
  setreadpio: 'Prepares for ATA PIO read/non-data command mode.',
  setwritepio: 'Prepares for ATA PIO write/non-data command mode.',
  setreaddma: 'Prepares for ATA DMA read mode.',
  setwritedma: 'Prepares for ATA DMA write mode.',
  ata28cmd: 'Executes a raw ATA 28-bit command.',
  ata48cmd: 'Executes a raw ATA 48-bit command.',
  writelog: 'Appends a string line to a text file.',
  setbuffer: 'Writes hex bytes directly into buffer at an offset.',
  endbuffer: 'Ends multi-line setbuffer input mode.',
  scratchpadsize: 'Sets scratchpad size.',
  writescratchpad: 'Writes hex bytes directly into scratchpad at an offset.',
  readscratchpad: 'Reads data into scratchpad.',
  copyscratchpadtobuffer: 'Copies bytes from scratchpad to buffer.',
  copybuffertoscratchpad: 'Copies bytes from buffer to scratchpad.',
  printscratchpad: 'Prints scratchpad contents for a given offset/size.',
  setscratchpad: 'Configures scratchpad write mode.',
  endscratchpad: 'Ends multi-line scratchpad input mode.',
  stringtoscratchpad: 'Copies a string variable into scratchpad bytes.',
  clearscratchpad: 'Clears scratchpad contents.',
  variablecheck: 'Checks whether a variable exists/has a usable value.',
  getfilesize: 'Stores file size in error_level.',
  deletefile: 'Deletes a file.',
  callcommand: 'Runs an external command.',
  userinput: 'Reads user input into a variable.',
  wordflipbuffer: 'Word-swaps bytes in the buffer range.',
  wordflipscratchpad: 'Word-swaps bytes in the scratchpad range.',
  getstatus: 'Reads current status information from the device interface.',
  softreset: 'Performs a software reset.',
  usleep: 'Sleeps for the given microseconds.',
  softtimeout: 'Sets soft reset timeout.',
  resettimeout: 'Sets reset timeout.',
  busytimeout: 'Sets busy timeout.',
  generaltimeout: 'Sets general timeout.',
  gettime: 'Updates built-in $time and $date variables.',
  reopendisk: 'Closes/reopens current disk (passthrough).',
  include: 'Includes another script.',
  loadscript: 'Loads and executes another script.',
  previousscript: 'Returns execution context to previous script.',
  upline: 'Moves execution one line up.'
};

const BUILTIN_VARIABLES = new Set(Object.keys(BUILTIN_VARIABLE_DOCS));

const BLOCK_OPENERS = {
  if: 'endif',
  while: 'done',
  subroutine: 'endsubroutine',
  setbuffer: 'endbuffer',
  setscratchpad: 'endscratchpad'
};

const BLOCK_CLOSERS = new Set(['endif', 'done', 'endsubroutine', 'endbuffer', 'endscratchpad']);

module.exports = {
  BLOCK_CLOSERS,
  BLOCK_OPENERS,
  BUILTIN_FUNCTION_DOCS,
  BUILTIN_VARIABLE_DOCS,
  BUILTIN_VARIABLES,
  COMMANDS,
  CONTROL_KEYWORD_DOCS,
  CONTROL_KEYWORDS,
  INCLUDE_COMMANDS
};
